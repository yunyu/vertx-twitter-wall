<!DOCTYPE html>
<html>
<head>
    <title>Vert.x Twitter Wall</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v2.1.0/dist/mini-default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.4/vue.min.js"></script>
    <style>
        header {
            padding: 8px;
        }

        .logo {
            display: inline-block;
        }

        .card {
            margin: 2px 7px 14px;
        }

        .card > .section.tweet {
            height: 165px;
        }

        .card > .section.tweet > p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 4px;
        }

        .tag-bar {
            float: right;
        }

        .tweet-container {
            margin-top: 8px;
        }
    </style>
</head>
<body>
<div id="app">
    <header>
        <div v-if="trackedTag" class="logo">Tracking #{{ trackedTag }}</div>
        <div v-else class="logo">Not tracking</div>
        <div class="input-group tag-bar">
            <input id="tag" type="text" placeholder="e.g. trump">
            <button id="set-tag" class="primary">Track hashtag</button>
        </div>
    </header>
    <div class="tweet-container">
        <div id="tweets" class="row">
            <div class="card" v-for="tweet in tweets">
                <div class="section tweet">
                    <p>{{ tweet.text }}</p>
                </div>
                <div class="section info">
                    <p>@{{ tweet.username }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            trackedTag: null,
            tweets: []
        }
    });

    var sock = new SockJS(window.location.origin + '/sock');
    sock.onmessage = function (e) {
        app.tweets.unshift(JSON.parse(e.data));
    };

    var tagInput = document.getElementById("tag");
    var setTagBtn = document.getElementById("set-tag");

    tagInput.addEventListener("keyup", function (event) {
        event.preventDefault();
        if (event.keyCode == 13) setTagBtn.click();
    });

    setTagBtn.onclick = function () {
        var newTag = tagInput.value;
        if (newTag.length == 0 || newTag.length > 120 || newTag == app.trackedTag) {
            tagInput.value = app.trackedTag;
            return;
        }
        if (app.trackedTag) {
            sock.send("UNREG " + app.trackedTag);
        }
        sock.send("REG " + newTag);
        app.trackedTag = newTag;
        app.tweets = [];
    };
</script>
</body>
</html>