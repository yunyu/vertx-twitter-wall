<!DOCTYPE html>
<html>
<head>
    <title>Vert.x Twitter Wall</title>
    <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v2.1.0/dist/mini-default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.2/sockjs.min.js"></script>
    <style>
        header {
            padding: 8px;
        }

        #status {
            display: inline-block;
        }

        .card > .section.tweet {
            height: 165px;
        }

        .card > .section.tweet > p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 4px;
        }

        .tag-bar {
            float: right;
        }

        .tweet-container {
            margin-top: 8px;
        }
    </style>
</head>
<body>
<header>
    <div class="logo" id="status">Not tracking</div>
    <div class="input-group tag-bar">
        <input id="tag" type="text" placeholder="e.g. trump">
        <button id="set-tag" class="primary">Track hashtag</button>
    </div>
</header>
<div class="tweet-container">
    <div id="tweets" class="row"></div>
</div>
<script>
    var entityMap = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;',
        '/': '&#x2F;',
        '`': '&#x60;',
        '=': '&#x3D;'
    };

    function escapeHtml(string) {
        return String(string).replace(/[&<>"'`=\/]/g, function (s) {
            return entityMap[s];
        });
    }

    var sock = new SockJS(window.location.origin + '/sock');
    sock.onmessage = function (e) {
        tweetsDiv.innerHTML = '<div class="card"><div class="section tweet"><p>' + e.data + "</p></div></div>"
            + tweetsDiv.innerHTML;
    };

    var tagInput = document.getElementById("tag");
    var setTagBtn = document.getElementById("set-tag");

    tagInput.addEventListener("keyup", function (event) {
        event.preventDefault();
        if (event.keyCode == 13) {
            setTagBtn.click();
        }
    });

    var tweetsDiv = document.getElementById("tweets");

    var lastTag = "";
    setTagBtn.onclick = function () {
        var newTag = tagInput.value;
        if (newTag.length == 0 || newTag == lastTag) {
            tagInput.value = lastTag;
            return;
        }
        if (lastTag.length > 0) {
            sock.send("UNREG " + lastTag);
        }
        sock.send("REG " + newTag);
        lastTag = newTag;
        document.getElementById("status").innerHTML = 'Tracking #' + escapeHtml(lastTag);
        tweetsDiv.innerHTML = "";
    };
</script>
</body>
</html>